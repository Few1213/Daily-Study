<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>$小几米$</title>
    <script>
        function ajax(method, url, params, done) {
            // 统一转换为大写便于后续判断
            method = method.toUpperCase();
            // 对象形式的参数转换为 urlencoded 格式 
            var pairs = [];
            for (var key in params) {
                pairs.push(key + '=' + params[key]);
            };
            var querystring = pairs.join('&');
            var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
            xhr.addEventListener('readystatechange', function () {
                if (this.readyState !== 4) return
                // 尝试通过 JSON 格式解析响应体 try {
                try {
                    done(JSON.parse(this.responseText))
                } catch (e) {
                    done(this.responseText)
                }
            })
            // 如果是 GET 请求就设置 URL 地址 问号参数 
            if (method === 'GET') {
                url += '?' + querystring
            }
            xhr.open(method, url)
            // 如果是 POST 请求就设置请求体 var data = null
            if (method === 'POST') {
                xhr.setRequestHeader('Content‐Type', 'application/x‐www‐form‐urlencoded')
                data = querystring
            }
            xhr.send(data)

            ajax('get', './get.php', {
                id: 123
            }, function (data) {
                console.log(data)
            })
            ajax('post', './post.php', {
                foo: 'posted data'
            }, function (data) {
                console.log(data)
            })
    </script>
</head>

<body>

</body>

</html>